<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wand Calibration User Guide</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #e0e0e0;
            background-color: #1e1e1e;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        h1 {
            color: #00bcd4;
            border-bottom: 2px solid #00bcd4;
            padding-bottom: 10px;
        }

        h2 {
            color: #4dd0e1;
            margin-top: 40px;
            border-bottom: 1px solid #333;
            padding-bottom: 5px;
        }

        h3 {
            color: #80deea;
            margin-top: 25px;
        }

        img {
            max-width: 100%;
            border: 1px solid #444;
            border-radius: 5px;
            margin: 20px 0;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .container {
            background-color: #252526;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        ul,
        ol {
            padding-left: 25px;
        }

        li {
            margin-bottom: 8px;
        }

        strong {
            color: #ffffff;
        }

        code {
            background-color: #333;
            padding: 2px 5px;
            border-radius: 3px;
            font-family: Consolas, monospace;
            color: #ff9800;
        }

        .step-block {
            margin-bottom: 20px;
            padding-left: 15px;
            border-left: 3px solid #00bcd4;
        }

        .highlight {
            background-color: #2d2d30;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #3e3e42;
        }
    </style>
</head>

<body>

    <div class="container">
        <h1>Wand Calibration User Guide</h1>
        <p>This guide walks you through the camera calibration process using a calibration wand in OpenLPT. The process
            consists of two main stages: <strong>Point Detection</strong> and <strong>Calibration</strong>.</p>

        <!-- Point Detection Section -->
        <h2>1. Point Detection</h2>
        <p>First, select the <strong>Wand Calibration</strong> tab and ensure you are on the <strong>Point
                Detection</strong> sub-tab.</p>

        <img src="wand_detection_ui.png" alt="Point Detection Interface">

        <div class="step-block">
            <h3>Step 1: Configure Settings</h3>
            <p>Set the detection parameters in the <strong>Detection Settings</strong> panel on the right:</p>
            <ul>
                <li><strong>Num Cameras</strong>: Enter the number of cameras in your setup (e.g., <code>2</code>).</li>
                <li><strong>Wand Type</strong>: Choose <strong>Dark on Bright</strong> (dark balls on a bright
                    background) or <strong>Bright on Dark</strong>.</li>
                <li><strong>Radius Range</strong>: Adjust the slider to cover the expected radius (in pixels) of the
                    wand balls in your images (e.g., <code>45</code> to <code>120</code>).</li>
                <li><strong>Sensitivity</strong>: Set the detection sensitivity (default is around <code>0.85</code>).
                </li>
            </ul>
        </div>

        <div class="step-block">
            <h3>Step 2: Load Camera Images</h3>
            <p>In the <strong>Camera Images</strong> table:</p>
            <ol>
                <li>For each <strong>Cam ID</strong>, load the corresponding folder of calibration images (click the
                    cell or a load button if available).</li>
                <li>Enter the initial <strong>Focal Length (px)</strong> (e.g., <code>9000</code>).</li>
                <li>Enter the detection <strong>Width</strong> and <strong>Height</strong> (e.g., <code>1280</code> x
                    <code>800</code>).</li>
            </ol>
        </div>

        <div class="step-block">
            <h3>Step 3: Verify and Process</h3>
            <ol>
                <li>Select a frame from the <strong>Frame List</strong>.</li>
                <li>Click <strong>Test Detect (Current Frame)</strong>.
                    <ul>
                        <li><em>Verification</em>: Look at the image view on the left. You should see <strong>green
                                circles</strong> identifying the two balls on the wand. If not, adjust the <em>Radius
                                Range</em> or <em>Sensitivity</em>.</li>
                    </ul>
                </li>
                <li>Once satisfied with the detection test, click <strong>Process All Frames / Resume</strong> to detect
                    points in all loaded images.</li>
            </ol>
        </div>

        <hr style="border-color: #444; margin: 40px 0;">

        <!-- Calibration Section -->
        <h2>2. Calibration</h2>
        <p>After extracting points, switch to the <strong>Calibration</strong> sub-tab.</p>

        <img src="wand_calibration_ui.png" alt="Calibration Interface">

        <div class="step-block">
            <h3>Step 4: Calibration Settings</h3>
            <p>Configure the physical model in <strong>Calibration Settings</strong>:</p>
            <ul>
                <li><strong>Camera Model</strong>: Select <strong>Pinhole</strong> (standard).</li>
                <li><strong>Wand Length</strong>: Enter the exact physical distance between the centers of the two wand
                    balls (e.g., <code>10.00 mm</code>). <span style="color: #ff5252;"><strong>Accurate measurement is
                            critical.</strong></span></li>
                <li><strong>Dist Coeffs</strong>: Number of distortion coefficients to optimize (typically
                    <code>0</code> for initial testing, or higher for complex lenses).</li>
            </ul>
        </div>

        <div class="step-block">
            <h3>Step 5: Run Optimization</h3>
            <ol>
                <li>Click the blue <strong>Run Calibration</strong> button.</li>
                <li>The system will optimize the camera parameters. The <strong>3D View</strong> on the left will
                    visualize the camera positions and wand points.</li>
            </ol>
        </div>

        <div class="step-block">
            <h3>Step 6: Analyze & Filter Errors</h3>
            <p>Review the <strong>Error Analysis</strong> table:</p>
            <ul>
                <li><strong>Reprojection Error (Cam 1, Cam 2, ...)</strong>: Ideally less than 1.0 pixel (blue/normal).
                    High errors (red) indicate outliers.</li>
                <li><strong>Length Error (Len Err)</strong>: deviation from the specified wand length.</li>
            </ul>
            <div class="highlight">
                <strong>Refinement:</strong>
                <ul>
                    <li>Mark valid/bad frames in the table.</li>
                    <li>Use the <strong>Delete when proj error > [X] px</strong> button to automatically remove frames
                        with high reprojection errors (e.g., <code>1.00 px</code>).</li>
                    <li><strong>Re-run Calibration</strong> after filtering to improve accuracy.</li>
                </ul>
            </div>
        </div>

        <div class="step-block">
            <h3>Step 7: Save Results</h3>
            <p>When the "Calibration Successful" message appears (or upon completion), you can save the resulting
                intrinsic and extrinsic parameters for usage in 3D tracking.</p>
        </div>

    </div>

</body>

</html>