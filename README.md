# OpenLPT 2.0

OpenLPT 2.0 is a new version of particle tracking code. It can be used for tracking dense tracers, polydisperse bubbles and many other objects. 

Look how easy it is to use:
```bash 
# Use in command line
${code_path}/bin/OpenLPT.exe config.txt
```

```python
# Use in python
import pyopenlpt as lpt

# redirect std::cout to python 
redirector = lpt.PythonStreamRedirector() 

config_file = '${path_to_config_file}'
lpt.run(config_file)
```

```bash
# Use GUI
conda activate OpenLPT
python gui/main.py
```

Please see the sample format of configuration files, camera files and image files in /test/test_STB or /test/test_STB_Bubble.

## Features
- User-friendly interface in python
- Lagrangian particle tracking for multiple objects (point-like particles, spherical particles, etc.)
- Support stereomatching with multiple cameras (at least 2)
- Include multiple test cases for users to test and understand the code
- Better structure for adding new functions


## Installation

### Step 1: Install Miniconda (if not already installed)

Download and install Miniconda for your operating system:
- **All platforms**: [Miniconda Download](https://docs.anaconda.com/miniconda/)

> **Windows users**: After installation, use **Anaconda Prompt** for all following commands.

> **macOS users**: You also need Xcode Command Line Tools. Run in Terminal:
> ```bash
> xcode-select --install
> ```

### Step 2: Install Mamba (faster package manager)

```bash
conda install -n base -c conda-forge mamba
```

### Step 3: Download and Install OpenLPT

```bash
# Download the code
git clone https://github.com/Sinchy/pyOpenLPT.git
cd pyOpenLPT

# Create environment and install all dependencies (including C++ compiler)
conda create -n OpenLPT python=3.11
conda activate OpenLPT
mamba install -c conda-forge --file requirements.txt

# Build and install the package
pip install . --no-build-isolation
```

### Step 4: Verify Installation

```python
import pyopenlpt as lpt
redirector = lpt.PythonStreamRedirector()
print("OpenLPT installed successfully!")
```

### Troubleshooting

| Problem | Solution |
|:--------|:---------|
| **Windows**: Build fails | Install [Visual Studio Build Tools](https://visualstudio.microsoft.com/visual-cpp-build-tools/) with "Desktop development with C++" |
| **macOS**: `omp.h` not found | See macOS OpenMP fix below |
| **macOS**: Wrong architecture | Ensure your conda env matches your CPU: `python -c "import platform; print(platform.machine())"` |
| **Linux**: Permission denied | Run `chmod +x` on the script, or use `sudo` |
| **All**: Stale cache | Delete build folder: `rm -rf build/` and retry |

#### macOS OpenMP Fix

If you get `fatal error: 'omp.h' file not found`:

```bash
# Set environment variables to use conda's OpenMP
export CC="$CONDA_PREFIX/bin/clang"
export CXX="$CONDA_PREFIX/bin/clang++"
export CPPFLAGS="-I$CONDA_PREFIX/include"
export LDFLAGS="-L$CONDA_PREFIX/lib"

# Then reinstall
pip install . --no-build-isolation
```

## GUI Usage

OpenLPT provides a graphical user interface for easier interaction with the tracking pipeline.

### Launch the GUI
```bash
conda activate OpenLPT
python gui/main.py
```

The GUI provides modules for:
- **Camera Calibration**: Wand and plate calibration workflows
- **Image Preprocessing**: Background subtraction and image enhancement
- **Tracking Settings**: Configure tracking parameters
- **Tracking**: Run the tracking algorithm with real-time visualization
- **Results**: View and export tracking results

## Installation - CPP Version
Users who want to install the pure cpp version can refer to the file [README_CPP.md](README_CPP.md)

## Contribute

- Issue Tracker: 
- Source Code: [OpenLPT 2.0](https://github.com/clockj/OpenLPT.git)
- We are happy that you enjoy our code. At the same time, we would like you give us the credits by citing the following reference in your work:

    - Tan, S., Salibindla, A., Masuk, A.U.M. and Ni, R., 2020. Introducing OpenLPT: new method of removing ghost particles and high-concentration particle shadow tracking. Experiments in Fluids, 61(2), p.47.
    
    - Tan, S., Zhong, S. and Ni, R., 2023. 3D Lagrangian tracking of polydispersed bubbles at high image densities. Experiments in Fluids, 64(4), p.85.

## Support

If you are having issues, please let me know.
I have a mailing list located at: szhong12@jhu.edu or tanshiyong84@gmail.com


## License

This repository contains a mix of original code (open-source under the license in `LICENSE`)
and MATLAB Coder–generated files under a MathWorks **Academic License**.

The following paths contain code that was generated by MATLAB Coder and is **NOT** covered by
the open-source license of this repository. These files are provided for **ACADEMIC INTERNAL
OPERATIONS ONLY** (teaching, academic research, and course requirements). **Government,
commercial, or other organizational use is NOT permitted**.

Restricted (MATLAB Coder–generated) paths:
- /src/srcObject/BubbleCenterAndSizeByCircle
- /src/srcObject/BubbleCenterAndSizeByCircle/CircleIdentifier.cpp
- /src/srcObject/BubbleResize
- /inc/libObject/BubbleCenterAndSizeByCircle
- /inc/libObject/CircleIdentifier.h
- /inc/libObject/BubbleResize

Requirements and conditions for the above paths:
- Do **not** modify or remove the “Academic License” header comments in those files.
- These files are **not** sublicensed under the repository’s open-source license (see `LICENSE`).
- If you redistribute this repository, you must keep this `NOTICE` file together with the
  original Academic License headers in the generated files.
- If you need to regenerate or modify the generated code, you must hold and comply with a valid
  MathWorks MATLAB Coder license; usage remains restricted to academic internal operations.

All **other** files outside the paths listed above are original work and are distributed under
the open-source license stated in `LICENSE`.

